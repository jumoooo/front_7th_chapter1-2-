# 📋 PRD - 반복 일정 기능

## 📋 기본 정보

- **작성일**: 2025-10-28
- **프로젝트명**: 캘린더 애플리케이션 - 반복 일정 기능
- **버전**: v1.0
- **작성자**: BMAD Analyst

---

## 🎯 문제 정의

### 📌 현재 상황

캘린더 애플리케이션은 현재 단일 일정만 지원합니다. 사용자가 반복되는 일정(예: 매일 아침 미팅, 매주 월요일 팀 회의, 매월 급여일 알림)을 등록하려면 각 날짜마다 개별적으로 일정을 생성해야 합니다.

### 😣 사용자 페인포인트

- **번거로움**: 동일한 일정을 반복적으로 입력해야 하는 불편함
- **실수 가능성**: 일부 날짜를 누락하거나 잘못 입력할 위험
- **수정의 어려움**: 반복 일정의 시간이나 내용이 변경되면 모든 일정을 개별적으로 수정해야 함
- **삭제의 어려움**: 반복 일정을 취소하려면 모든 일정을 하나씩 삭제해야 함

### 💼 비즈니스 임팩트

- 사용자 만족도 저하
- 앱 사용 효율성 감소
- 타 캘린더 앱 대비 기능 부족
- 반복 일정 미지원으로 인한 사용자 이탈 가능성

---

## 🎯 목표 및 성공 지표

### 🎯 주요 목표

1. **편의성 향상**: 사용자가 한 번의 입력으로 반복 일정을 생성할 수 있도록 개선
2. **유연성 제공**: 매일/매주/매월/매년 단위의 다양한 반복 패턴 지원
3. **관리 효율성**: 반복 일정의 수정 및 삭제 시 단일/전체 선택 옵션 제공

### 📊 성공 지표

- [x] 반복 일정 생성부터 삭제까지 전체 플로우가 에러 없이 동작
- [x] 과제 요구사항의 모든 체크리스트 항목 통과 (100%)
- [x] 테스트 커버리지 90% 이상 달성
- [x] 특수 케이스(31일, 윤년 29일) 정확히 처리
- [x] TypeScript 타입 안정성 100% (any 타입 사용 금지)

---

## 👥 사용자 스토리

### Epic 1: 반복 일정 생성

#### 📖 Epic 설명

- **As a** 캘린더 사용자
- **I want** 반복 일정을 한 번에 생성하고 관리하고 싶습니다
- **So that** 반복되는 일정을 효율적으로 관리하고 시간을 절약할 수 있습니다

---

#### User Story 1.1: 반복 유형 선택

**시나리오**: 일정 생성 시 반복 유형 선택

- **Given** 사용자가 일정 추가 폼을 열었을 때
- **When** "반복 일정" 체크박스를 클릭하면
- **Then** 반복 유형 선택 UI가 표시되어야 함
  - 반복 유형 셀렉트박스 (매일/매주/매월/매년)
  - 반복 간격 입력 필드
  - 반복 종료일 입력 필드

---

#### User Story 1.2: 매일 반복 일정 생성

**시나리오**: 매일 반복되는 일정 생성

- **Given** 사용자가 "반복 일정"을 활성화하고
- **And** 반복 유형으로 "매일"을 선택하고
- **And** 반복 간격을 "1"로 설정하고
- **And** 반복 종료일을 "2024-12-31"로 설정했을 때
- **When** "일정 추가" 버튼을 클릭하면
- **Then** 시작일부터 종료일까지 매일 반복되는 일정이 생성되어야 함

---

#### User Story 1.3: 매주 반복 일정 생성

**시나리오**: 매주 반복되는 일정 생성

- **Given** 사용자가 "반복 일정"을 활성화하고
- **And** 반복 유형으로 "매주"를 선택하고
- **And** 반복 간격을 "1"로 설정하고
- **And** 반복 종료일을 "2024-12-31"로 설정했을 때
- **When** "일정 추가" 버튼을 클릭하면
- **Then** 시작일부터 종료일까지 매주 같은 요일에 반복되는 일정이 생성되어야 함

---

#### User Story 1.4: 매월 반복 일정 생성 (특수 케이스: 31일)

**시나리오**: 31일에 매월 반복 일정 생성

- **Given** 사용자가 날짜를 "2024-01-31"로 설정하고
- **And** "반복 일정"을 활성화하고
- **And** 반복 유형으로 "매월"을 선택하고
- **And** 반복 종료일을 "2024-12-31"로 설정했을 때
- **When** "일정 추가" 버튼을 클릭하면
- **Then** 31일이 있는 달(1월, 3월, 5월, 7월, 8월, 10월, 12월)에만 일정이 생성되어야 함
- **And** 31일이 없는 달(2월, 4월, 6월, 9월, 11월)에는 일정이 생성되지 않아야 함
- **Note**: 매월 마지막 날이 아닌, 정확히 31일에만 생성

---

#### User Story 1.5: 매년 반복 일정 생성 (특수 케이스: 윤년 29일)

**시나리오**: 윤년 2월 29일에 매년 반복 일정 생성

- **Given** 사용자가 날짜를 "2024-02-29"로 설정하고
- **And** "반복 일정"을 활성화하고
- **And** 반복 유형으로 "매년"을 선택하고
- **And** 반복 종료일을 "2028-12-31"로 설정했을 때
- **When** "일정 추가" 버튼을 클릭하면
- **Then** 윤년(2024, 2028)의 2월 29일에만 일정이 생성되어야 함
- **And** 평년(2025, 2026, 2027)에는 일정이 생성되지 않아야 함

---

#### User Story 1.6: 반복 종료 조건 설정

**시나리오**: 특정 날짜까지 반복 종료 설정

- **Given** 사용자가 반복 일정을 설정할 때
- **When** 반복 종료일 필드에 날짜를 입력하면
- **Then** 해당 날짜까지만 반복 일정이 생성되어야 함
- **And** 반복 종료일은 최대 "2025-12-31"까지 설정 가능해야 함

---

### Epic 2: 반복 일정 표시

#### 📖 Epic 설명

- **As a** 캘린더 사용자
- **I want** 반복 일정을 캘린더에서 시각적으로 구분하고 싶습니다
- **So that** 반복 일정과 단일 일정을 쉽게 구별할 수 있습니다

---

#### User Story 2.1: 캘린더 뷰에서 반복 일정 아이콘 표시

**시나리오**: 반복 일정에 아이콘 표시

- **Given** 캘린더 뷰(월별 또는 주별)를 보고 있을 때
- **When** 반복 일정이 있는 날짜를 확인하면
- **Then** 반복 아이콘(🔁 또는 MUI Repeat 아이콘)이 일정 제목 옆에 표시되어야 함
- **And** 단일 일정에는 아이콘이 표시되지 않아야 함

---

#### User Story 2.2: 반복 주기에 맞게 여러 날짜에 표시

**시나리오**: 매일 반복 일정이 여러 날짜에 표시됨

- **Given** 매일 반복되는 일정이 생성되었을 때
- **When** 월별 캘린더 뷰를 확인하면
- **Then** 해당 월의 모든 날짜에 반복 일정이 표시되어야 함

**시나리오**: 매주 반복 일정이 같은 요일에 표시됨

- **Given** 매주 월요일 반복되는 일정이 생성되었을 때
- **When** 월별 캘린더 뷰를 확인하면
- **Then** 해당 월의 모든 월요일에 반복 일정이 표시되어야 함

---

#### User Story 2.3: 일정 목록에서 반복 정보 표시

**시나리오**: 일정 목록에서 반복 정보 확인

- **Given** 일정 목록을 보고 있을 때
- **When** 반복 일정을 확인하면
- **Then** 반복 정보가 텍스트로 표시되어야 함
  - 예: "반복: 1일마다"
  - 예: "반복: 1주마다 (종료: 2024-12-31)"
  - 예: "반복: 1월마다"
  - 예: "반복: 1년마다"

---

### Epic 3: 반복 일정 수정

#### 📖 Epic 설명

- **As a** 캘린더 사용자
- **I want** 반복 일정을 수정할 때 단일/전체 선택 옵션을 원합니다
- **So that** 특정 날짜만 수정하거나 모든 반복 일정을 한 번에 수정할 수 있습니다

---

#### User Story 3.1: 반복 일정 수정 시 확인 다이얼로그 표시

**시나리오**: 반복 일정 수정 시 확인 요청

- **Given** 사용자가 반복 일정을 선택하고
- **When** "수정" 버튼을 클릭하면
- **Then** "해당 일정만 수정하시겠어요?" 확인 다이얼로그가 표시되어야 함
- **And** "예" 및 "아니오" 버튼이 제공되어야 함

---

#### User Story 3.2: 단일 반복 일정 수정

**시나리오**: 특정 날짜의 반복 일정만 수정

- **Given** 사용자가 반복 일정 수정 확인 다이얼로그에서
- **When** "예" 버튼을 클릭하고 일정 정보를 수정한 후 저장하면
- **Then** 해당 날짜의 일정만 수정되어야 함
- **And** 수정된 일정은 더 이상 반복 일정이 아니어야 함 (repeat.type = 'none')
- **And** 반복 아이콘이 사라져야 함
- **And** 다른 날짜의 반복 일정은 영향받지 않아야 함

---

#### User Story 3.3: 전체 반복 일정 수정

**시나리오**: 모든 반복 일정을 한 번에 수정

- **Given** 사용자가 반복 일정 수정 확인 다이얼로그에서
- **When** "아니오" 버튼을 클릭하고 일정 정보를 수정한 후 저장하면
- **Then** 모든 반복 일정이 동일하게 수정되어야 함
- **And** 반복 일정 속성은 유지되어야 함
- **And** 반복 아이콘이 유지되어야 함

---

### Epic 4: 반복 일정 삭제

#### 📖 Epic 설명

- **As a** 캘린더 사용자
- **I want** 반복 일정을 삭제할 때 단일/전체 선택 옵션을 원합니다
- **So that** 특정 날짜만 삭제하거나 모든 반복 일정을 한 번에 삭제할 수 있습니다

---

#### User Story 4.1: 반복 일정 삭제 시 확인 다이얼로그 표시

**시나리오**: 반복 일정 삭제 시 확인 요청

- **Given** 사용자가 반복 일정을 선택하고
- **When** "삭제" 버튼을 클릭하면
- **Then** "해당 일정만 삭제하시겠어요?" 확인 다이얼로그가 표시되어야 함
- **And** "예" 및 "아니오" 버튼이 제공되어야 함

---

#### User Story 4.2: 단일 반복 일정 삭제

**시나리오**: 특정 날짜의 반복 일정만 삭제

- **Given** 사용자가 반복 일정 삭제 확인 다이얼로그에서
- **When** "예" 버튼을 클릭하면
- **Then** 해당 날짜의 일정만 삭제되어야 함
- **And** 다른 날짜의 반복 일정은 유지되어야 함
- **And** 캘린더 뷰에서 해당 날짜의 일정만 사라져야 함

---

#### User Story 4.3: 전체 반복 일정 삭제

**시나리오**: 모든 반복 일정을 한 번에 삭제

- **Given** 사용자가 반복 일정 삭제 확인 다이얼로그에서
- **When** "아니오" 버튼을 클릭하면
- **Then** 모든 반복 일정이 삭제되어야 함
- **And** 캘린더 뷰에서 모든 반복 일정이 사라져야 함
- **And** 일정 목록에서도 해당 반복 일정이 사라져야 함

---

## 📋 수용 기준 (Acceptance Criteria)

### AC 1: 반복 유형 선택

- [x] 일정 생성/수정 폼에 "반복 일정" 체크박스가 있어야 함
- [x] 체크박스 활성화 시 반복 설정 UI가 표시되어야 함
- [x] 반복 유형 선택: 매일, 매주, 매월, 매년 (4가지)
- [x] 반복 간격 입력 필드 (기본값: 1)
- [x] 반복 종료일 입력 필드 (date 타입, 최대: 2025-12-31)
- [x] 반복 일정은 일정 겹침 검증을 하지 않아야 함

---

### AC 2: 반복 일정 생성

- [x] 매일 반복: 시작일부터 종료일까지 매일 일정 생성
- [x] 매주 반복: 시작일의 요일과 같은 요일에 매주 일정 생성
- [x] 매월 반복: 시작일의 일자와 같은 날에 매월 일정 생성
  - [x] 31일 선택 시 31일이 있는 달에만 생성 (1, 3, 5, 7, 8, 10, 12월)
  - [x] 31일이 없는 달에는 생성하지 않음
- [x] 매년 반복: 시작일의 월/일과 같은 날에 매년 일정 생성
  - [x] 2월 29일 선택 시 윤년에만 생성
  - [x] 평년에는 생성하지 않음
- [x] 반복 종료일이 설정된 경우 해당 날짜까지만 생성
- [x] 반복 종료일이 없는 경우 최대 2025-12-31까지 생성

---

### AC 3: 반복 일정 표시

- [x] 캘린더 뷰(월별/주별)에서 반복 일정에 아이콘 표시
- [x] MUI `Repeat` 아이콘 또는 🔁 이모지 사용
- [x] 반복 주기에 맞게 여러 날짜에 일정 표시
- [x] 일정 목록에서 반복 정보 텍스트로 표시
  - [x] "반복: N일마다"
  - [x] "반복: N주마다"
  - [x] "반복: N월마다"
  - [x] "반복: N년마다"
  - [x] 종료일이 있는 경우: "(종료: YYYY-MM-DD)"
- [x] 단일 일정(repeat.type = 'none')은 아이콘이 없어야 함

---

### AC 4: 반복 일정 수정

- [x] 반복 일정 수정 시 "해당 일정만 수정하시겠어요?" 다이얼로그 표시
- [x] "예" 선택 시:
  - [x] 해당 날짜의 일정만 수정
  - [x] repeat.type을 'none'으로 변경 (단일 일정화)
  - [x] 반복 아이콘 제거
  - [x] 다른 반복 일정은 영향 없음
- [x] "아니오" 선택 시:
  - [x] 모든 반복 일정 수정
  - [x] repeat 속성 유지
  - [x] 반복 아이콘 유지
- [x] 일반 단일 일정 수정 시에는 다이얼로그 표시하지 않음

---

### AC 5: 반복 일정 삭제

- [x] 반복 일정 삭제 시 "해당 일정만 삭제하시겠어요?" 다이얼로그 표시
- [x] "예" 선택 시:
  - [x] 해당 날짜의 일정만 삭제
  - [x] 다른 반복 일정은 유지
- [x] "아니오" 선택 시:
  - [x] 모든 반복 일정 삭제
  - [x] 캘린더 뷰와 일정 목록에서 모두 제거
- [x] 일반 단일 일정 삭제 시에는 다이얼로그 표시하지 않음

---

## 🚫 비기능 요구사항 (NFR)

### ⚡ 성능

- [x] 반복 일정 생성 시 최대 2025-12-31까지만 처리 (과제 요구사항)
- [x] 캘린더 뷰 렌더링 시 보이는 범위의 반복 일정만 확장
- [x] 반복 일정 확장 로직은 O(n) 시간 복잡도 이내
- [x] 대량 반복 일정(1년 이상)도 1초 이내 렌더링

### 🎨 사용성

- [x] 반복 일정 UI는 직관적이고 이해하기 쉬워야 함
- [x] 확인 다이얼로그는 명확한 안내 메시지 제공
- [x] 반복 일정과 단일 일정을 시각적으로 명확히 구분 (아이콘)
- [x] 반복 설정 UI는 토글 방식으로 숨김/표시

### ♿ 접근성

- [x] Material-UI 컴포넌트의 접근성 기본 지원 활용
- [x] 반복 아이콘에 aria-label 제공
- [x] 다이얼로그는 키보드 네비게이션 지원
- [x] 스크린 리더 호환성 고려

### 🧪 테스트 커버리지

- [x] 라인 커버리지 90% 이상
- [x] 모든 반복 유형(daily/weekly/monthly/yearly)에 대한 테스트
- [x] 특수 케이스(31일, 윤년 29일) 테스트
- [x] 단일/전체 수정 테스트
- [x] 단일/전체 삭제 테스트
- [x] Given-When-Then 패턴으로 테스트 작성

### 🔒 타입 안정성

- [x] TypeScript 타입 안정성 100%
- [x] any 타입 사용 금지
- [x] 모든 함수와 변수에 명시적 타입 지정
- [x] RepeatType, RepeatInfo 타입 활용

---

## ⚠️ 리스크 및 제약사항

### 🚨 기술적 리스크

#### 리스크 1: 특수 날짜 처리 복잡성

- **설명**: 31일, 윤년 29일 등 특수 케이스 처리 로직의 복잡성
- **영향도**: 높음
- **대응 방안**:
  - 날짜 유효성 검증 함수를 별도로 분리 (`isValidRecurringDate`)
  - 충분한 테스트 케이스 작성 (경계값 테스트 포함)
  - 윤년 판별 로직 정확히 구현 (4년 배수 && (100년 배수 아님 || 400년 배수))

#### 리스크 2: 반복 일정 데이터 모델 설계

- **설명**: 단일 수정/삭제를 지원하기 위한 데이터 구조 설계
- **영향도**: 중간
- **대응 방안**:
  - Option 1: parentEventId 추가하여 반복 그룹 식별
  - Option 2: 예외 날짜 목록(exceptions) 관리
  - Architect 에이전트와 협의하여 최적 방안 선택

#### 리스크 3: 대량 반복 일정 성능 저하

- **설명**: 1년 이상의 매일 반복 일정 생성 시 성능 저하 가능성
- **영향도**: 낮음 (최대 날짜 제한으로 완화)
- **대응 방안**:
  - 최대 날짜 2025-12-31로 제한
  - 현재 뷰 범위만 확장하여 렌더링
  - useMemo, useCallback 활용

---

### ⏱️ 일정 제약

#### 제약 1: 과제 제출 기한

- **설명**: 정해진 기한 내에 모든 기능 구현 필요
- **대응 방안**:
  - Phase별 우선순위에 따라 단계적 구현
  - MVP 기능 우선 완성 후 개선사항 추가

#### 제약 2: TDD 방식 개발 시간

- **설명**: 테스트 우선 작성으로 인한 초기 개발 시간 증가
- **대응 방안**:
  - 장기적으로는 버그 감소 및 리팩토링 용이성으로 시간 절약
  - 테스트 템플릿 활용

---

### 🛠️ 리소스 제약

#### 제약 1: 기존 코드 수정 제한

- **설명**: `// No Ai` 주석, 기존 함수/타입/컴포넌트 수정 금지
- **대응 방안**:
  - 신규 함수 추가 및 확장 방식으로 구현
  - 기존 types.ts의 RepeatInfo 활용

#### 제약 2: 에이전트 파일 수정 금지

- **설명**: `.cursorrules`, `GEMINI.md`, `agents/` 폴더 수정 불가
- **대응 방안**:
  - 산출물만 생성하고 규칙 파일은 변경하지 않음

---

## 🔄 다음 단계

### 📌 PM 에이전트

- [x] 기능 우선순위 결정
- [x] Phase 1~4 릴리스 계획 수립
- [x] 성공 지표 세부 정의

### 📌 Architect 에이전트

- [x] 데이터 모델 설계 (parentEventId vs exceptions)
- [x] 반복 일정 확장 로직 설계
- [x] API 인터페이스 정의
- [x] 컴포넌트 구조 설계

---

## ✅ Analyst 체크리스트

- [x] 모든 사용자 스토리가 Given-When-Then 형식으로 작성됨
- [x] 수용 기준이 테스트 가능함 (체크리스트 형식)
- [x] 비기능 요구사항이 명확함 (성능/사용성/접근성/테스트/타입안정성)
- [x] 리스크가 식별되고 대응 방안이 있음
- [x] 다음 에이전트(PM, Architect)가 작업할 수 있는 충분한 정보 제공

---

## 📈 점수 현황 (Score Status)

- **획득 점수 (Acquired Score):** 5점 (체크리스트 5개 항목 완료)
- **누적 점수 (Cumulative Score):** 20점 (이전 15점 + 현재 5점)
- **총점 (Total Score):** 예상 총점 100점

---

**작성자**: BMAD Analyst  
**다음 핸드오프**: PM 및 Architect 에이전트 병렬 작업  
**참조 문서**:

- `mockdowns/artifacts/orchestrator/2025-10-28_PRD_summary_v1.0.md`
- `mockdowns/artifacts/orchestrator/2025-10-28_Architecture_summary_v1.0.md`
- `mockdowns/artifacts/2025-10-28_project_structure_v1.0.md`
